<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agregar</title>
    <link rel="stylesheet" href="/styles.css">
    <link rel="icon" type="img/png" href="./logo.png">
    <link rel="stylesheet" href="/otros/agregar.css">
</head>

<body>
  <header>
    <nav>
        <a href="/"><img src="/logo.png" class="logo" alt=""></a>
        
        <ul>
            <a href="/"><h1>Deposito La 103</h1></a>
        </ul>
        <div class="imgusermenu">
            <img src="../log/user-photo.png" class="user_pic" id="user_pic" alt="" onclick="toggleMenu()">
                <span onclick="toggleMenu()">usernameDisplay</span>
            </img>
        </div>
        
        
        <a href="/login" class="login-button" id="loginButton" style="display: none;"><img src="../log/user-photo.png" class="login-button" alt=""><span>Iniciar Sesion</span></a>
        <div class="sub-menu-wrap" id="subMenu" style="display: none;">
            <div class="sub-menu">
                <div class="user-info">
                    <img src="../log/user-photo.png" alt="">
                    <h2>usernameDisplay</h2>
                </div>
                <hr>
                <a href="/perfil" class="sub-menu-link">
                    <img src="../log/perfilwhite.png" alt=""> <p>Perfil</p>
                    <span></span>
                </a>
                <a href="/config" class="sub-menu-link">
                    <img src="../log/configuracionwhite.png" alt=""> <p>Configuración</p>
                    <span></span>
                </a>
                <a href="/agregar" class="sub-menu-link">
                    <img src="../log/morewhite.png" alt=""> <p>Configuración</p>
                    <span></span>
                </a>
                <a href="/logout" class="sub-menu-link">
                    <img src="../log/salidawhite.png" alt=""> <p>Cerrar Sesión</p>
                    <span></span>
                </a>
            </div>
        </div>
    </nav>
  </header>
  <main>
    <form id="productForm">
        <div class="contenedor">
            <div class="api-agregar">
                <div class="api-agregar">
                    <h1 style="margin-top: 0;">Producto</h1>
                    <label for="searchIdOrName">Buscar por ID o Nombre:</label>
                    <input type="text" id="searchIdOrName" name="searchIdOrName">
                    <button type="button" onclick="buscarProducto()">Buscar</button><br><br>
            
                    <label for="categoria_id">ID de categoría:</label>
                    <input type="number" id="categoria_id" name="categoria_id" min="1" inputmode="numeric" pattern="^[0-9]*$">
                  
                    <label for="nombre">Nombre:</label>
                    <input type="text" id="nombre" name="nombre">
                  
                    <label for="descripcion">Descripción:</label>
                    <input type="text" id="descripcion" name="descripcion">
                  
                    <label for="precio">Precio (USD):</label>
                    <input type="number" id="precio" name="precio" min="0.00" inputmode="numeric" pattern="^\d+(\.\d{1,2})?$" placeholder="Formato: $0.00">
                  
                    <!-- Cambio de input a botón para subir imagen -->
                    <label for="img">Subir Imagen:</label>
                    <input type="file" id="img" name="img" accept="image/*"><br><br>
                  
                    <!-- Campo oculto para almacenar el ID del producto encontrado -->
                    <input type="hidden" id="productID" name="productID">
                </div>
            </div>
            <div class="previsualizar">
                <h1 id="titulo-prev">Previsualización</h1>
                <div class="prev-img-product">
                    <label for="img-prev"></label>
                    <img src="" alt="" name="img-prev" id="img-prev">
                    <p></p>
                </div>
            </div>
        </div>
        <div class="botones-api">
            <button type="button" id="crearbutton" onclick="crearProducto()">Crear</button>
            <button type="button" id="modificarbutton" onclick="modificarProducto()">Modificar</button>
            <button type="button" id="eliminarbutton" onclick="eliminarProducto()">Eliminar</button>
        </div>
     </form>
  </main>
  
  <script>
    function closeChatbot() {
        document.querySelector('.chatbot-container').style.display = 'none';
    }

    if (document.cookie.includes('logged_in=true')) {
    // Si está logeado, muestra el menú desplegable y el nombre de usuario
    document.getElementById('loginButton').style.display = 'none'; // Oculta el botón de inicio de sesión
    document.getElementById('subMenu').style.display = 'block'; // Muestra el menú desplegable

    // Configura el nombre de usuario
    const username = document.cookie.replace(/(?:(?:^|.*;\s*)username\s*=\s*([^;]*).*$)|^.*$/, '$1');
    document.querySelector('.user-info h2').textContent = username;
    document.querySelector('.imgusermenu span').textContent = username;

    } else {
        // Si no está logeado, muestra el botón de inicio de sesión y oculta el menú desplegable
        document.getElementById('loginButton').style.display = 'block'; // Muestra el botón de inicio de sesión
        document.getElementById('subMenu').style.display = 'none'; // Oculta el menú desplegable
        document.querySelector('.imgusermenu').style.display= 'none';

    }


    let subMenu = document.getElementById("subMenu");

    function toggleMenu(){
        subMenu.classList.toggle("open-menu")
    }

    // Seleccionar el input de tipo file
    const inputImg = document.getElementById('img');

    // Agregar un listener para el cambio en el input file
    inputImg.addEventListener('change', function(event) {
        const file = event.target.files[0]; // Obtener el archivo seleccionado

        // Crear un objeto URL para la imagen seleccionada
        const imgUrl = URL.createObjectURL(file);

        // Mostrar la imagen en el área de previsualización
        const imgPreview = document.getElementById('img-prev');
        imgPreview.src = imgUrl;
        imgPreview.style.display = 'block'; // Mostrar la imagen si estaba oculta
    });

    const nombreInput = document.getElementById('nombre');
    const nombrePreviewLabel = document.querySelector('.prev-img-product label');

    nombreInput.addEventListener('input', function(event) {
        const nombreValue = event.target.value;
        nombrePreviewLabel.textContent = nombreValue;
    });

    const precioInput = document.getElementById('precio');
    const precioPreview = document.querySelector('.prev-img-product p');

    precioInput.addEventListener('input', function(event) {
        const precioValue = event.target.value.trim(); // Obtener el valor y eliminar espacios en blanco al inicio y final

        // Verificar si el campo de precio está vacío o no
        if (precioValue === '') {
            precioPreview.textContent = ''; // Dejar el texto del párrafo vacío
        } else {
            // Si hay un valor, formatearlo y mostrarlo en el párrafo
            const formattedPrice = parseFloat(precioValue).toFixed(2);
            precioPreview.textContent = `Precio: $${formattedPrice}`;
        }
    });

    const urlParams = new URLSearchParams(window.location.search);
    const username = urlParams.get('username');
    document.getElementById('usernameDisplay').textContent = username;
  </script>
</body>
</html>